---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# nesevals

<!-- badges: start -->
<!-- badges: end -->

nesevals provides tooling for evaluating next edit suggestion (NES) scaffolds across different edit history formats, output formats, and models.

## Installation

Install the package with:

```r
# if needed:
# install.packages("pak")

pak::pak("posit-dev/nesevals")
```

## Example

The package ships with a data frame `nes_results` that summarizes experimental results:

```{r results}
#| message: false
#| warning: false
library(dplyr)
library(nesevals)

glimpse(nes_results)
```

```{r}
#| message: false
#| echo: false
#| label: results-plot
library(ggplot2)
library(ggrepel)
library(ggforce)

qwen_cluster <- nes_results |>
  dplyr::filter(model == "qwen3-8b", median_latency_ms < 200, mean_score < 3.5)

label_data <- nes_results |>
  dplyr::filter(model %in% c("claude-haiku-4-5-20251001", "openai/gpt-oss-20b", "qwen3-8b", "zeta",
                              "gpt-4.1-nano-2025-04-14", "gpt-5-nano")) |>
  dplyr::slice_max(mean_score, by = model, n = 1) |>
  dplyr::mutate(label = dplyr::case_when(
    model == "claude-haiku-4-5-20251001" ~ "Claude Haiku 4.5 (Anthropic)",
    model == "openai/gpt-oss-20b"        ~ "GPT-OSS 20B (Groq)",
    model == "qwen3-8b"                  ~ "Qwen3-8B (Baseten)",
    model == "zeta"                      ~ "Zeta (Baseten)",
    model == "gpt-4.1-nano-2025-04-14"  ~ "GPT-4.1 Nano (OpenAI)",
    model == "gpt-5-nano"               ~ "GPT-5 Nano (OpenAI)"
  ))

hull_label <- data.frame(
  median_latency_ms = max(qwen_cluster$median_latency_ms),
  mean_score        = mean(qwen_cluster$mean_score),
  label             = "Other Qwen3-8B\nscaffolds (Baseten)"
)

ggplot(nes_results) +
  aes(x = median_latency_ms, y = mean_score) +
  geom_mark_hull(
    data = qwen_cluster,
    expand = unit(3, "mm"),
    color = "black",
    fill = NA
  ) +
  geom_point() +
  geom_text_repel(
    data = label_data,
    aes(label = label)
  ) +
  geom_text_repel(
    data = hull_label,
    aes(label = label),
    nudge_x = 400,
    segment.curvature = -0.1
  ) +
  labs(
    title = "NES Scaffold Performance vs. Latency",
    x = "Median Latency (ms)",
    y = "Mean Model-Graded Quality Score"
  ) +
  theme_minimal() +
  expand_limits(x = 0)
```


